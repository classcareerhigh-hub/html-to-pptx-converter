<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered PT Generator (Pro)</title>
  
  <!-- PptxGenJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (í•„ìˆ˜) -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.min.js"></script>

  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ + ì¼ë¶€ ê°œì„  */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }
    h1 {
      background: linear-gradient(135deg, #0071EC 0%, #5050EF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .subtitle { color: #64748b; font-size: 16px; }

    .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    @media (max-width: 1024px) { .main-grid { grid-template-columns: 1fr; } }

    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      height: 800px; /* ê³ ì • ë†’ì´ */
    }

    .card-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #1e293b; display: flex; align-items: center; gap: 8px; }

    textarea {
      flex: 1;
      width: 100%;
      padding: 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      resize: none;
      background: #f8fafc;
      color: #334155;
      line-height: 1.5;
    }
    textarea:focus { outline: none; border-color: #0071EC; background: white; }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 15px;
    }
    .btn-primary {
      background: #0071EC;
      color: white;
      width: 100%;
    }
    .btn-primary:hover { background: #005bbd; transform: translateY(-2px); }
    
    .status-bar {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      display: none;
    }
    .status-bar.info { background: #e0f2fe; color: #0369a1; display: block; }
    .status-bar.success { background: #dcfce7; color: #15803d; display: block; }
    .status-bar.error { background: #fee2e2; color: #b91c1c; display: block; }

    /* File Upload Styling */
    .file-drop-zone {
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #f1f5f9;
      margin-bottom: 20px;
    }
    .file-drop-zone:hover { border-color: #0071EC; background: #eff6ff; }
    
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>AI-Powered Presentation Generator</h1>
    <p class="subtitle">ë³µì¡í•œ HTML ë””ìì¸ì„ ì™„ë²½í•œ PPTX ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤ (Hanwha Style Supported)</p>
  </div>

  <div class="main-grid">
    <!-- Left: Input Source -->
    <div class="card">
      <h2 class="card-title">ğŸ“ HTML Source Code</h2>
      
      <!-- File Upload added for convenience -->
      <div class="file-drop-zone" onclick="document.getElementById('fileInput').click()">
        <span style="font-size: 24px;">ğŸ“‚</span><br>
        <span style="font-weight: 600; color: #64748b;">HTML íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</span>
        <input type="file" id="fileInput" accept=".html,.txt" style="display: none;" onchange="handleFileUpload(event)">
      </div>

      <textarea id="htmlInput" placeholder="ì—¬ê¸°ì— HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
      <div id="statusMessage" class="status-bar"></div>
    </div>

    <!-- Right: Preview & Convert -->
    <div class="card">
      <h2 class="card-title">ğŸ“Š Converter Settings</h2>
      
      <div style="background: #f1f5f9; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
        <p style="font-weight: 600; margin-bottom: 10px;">ğŸ¨ Design System</p>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <div style="width: 20px; height: 20px; background: #0071EC; border-radius: 4px;"></div>
          <span>Primary: #0071EC (Blue)</span>
        </div>
        <div style="display: flex; gap: 10px;">
          <div style="width: 20px; height: 20px; background: #5050EF; border-radius: 4px;"></div>
          <span>Secondary: #5050EF (Purple)</span>
        </div>
      </div>

      <div style="flex: 1; background: #f8fafc; border-radius: 12px; padding: 20px; border: 2px solid #e2e8f0; overflow-y: auto;">
        <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ“‹ ë³€í™˜ ê¸°ëŠ¥ ì•ˆë‚´</h3>
        <ul style="font-size: 14px; color: #475569; padding-left: 20px; line-height: 1.6;">
          <li><b>Auto Layout:</b> .row, .col í´ë˜ìŠ¤ ìë™ ì¸ì‹ (ê°€ë¡œ ë°°ì¹˜)</li>
          <li><b>Smart Box:</b> .box í´ë˜ìŠ¤ ë””ìì¸(ë°°ê²½ìƒ‰, í…Œë‘ë¦¬) êµ¬í˜„</li>
          <li><b>Typography:</b> .action-title, .big-stat ë“± íŠ¹ìˆ˜ í´ë˜ìŠ¤ ì§€ì›</li>
          <li><b>Table:</b> ë³µì¡í•œ ë°ì´í„° í‘œ ìŠ¤íƒ€ì¼ë§ ìœ ì§€</li>
          <li><b>Colors:</b> HTML ë‚´ì˜ var(--primary-blue) ë“± ë³€ìˆ˜ í•´ì„</li>
        </ul>
      </div>

      <button class="btn-primary" onclick="convertToPPTX()">
        <span>âš¡ PPTXë¡œ ë³€í™˜í•˜ê¸°</span>
      </button>
    </div>
  </div>
</div>

<script>
  // --- Global Constants (Hanwha Style) ---
  const COLORS = {
    primary: '0071EC',
    secondary: '5050EF',
    dark: '222222',
    muted: '555555',
    lightBg: 'F5F5F5',
    white: 'FFFFFF'
  };

  const statusEl = document.getElementById('statusMessage');

  function showStatus(msg, type) {
    statusEl.textContent = msg;
    statusEl.className = `status-bar ${type}`;
    if (type === 'success') setTimeout(() => statusEl.style.display = 'none', 5000);
  }

  // File Upload Handler
  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('htmlInput').value = e.target.result;
      showStatus('HTML íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    };
    reader.readAsText(file);
  }

  // --- Main Conversion Logic ---
  async function convertToPPTX() {
    const htmlContent = document.getElementById('htmlInput').value;
    if (!htmlContent.trim()) {
      showStatus('HTML ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
      return;
    }

    showStatus('PPTX ìƒì„± ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', 'info');

    try {
      const pptx = new PptxGenJS();
      pptx.layout = 'LAYOUT_16x9';
      pptx.author = 'Career High AI';
      pptx.title = 'AI Generated Presentation';

      // HTML Parsing
      const parser = new DOMParser();
      const doc = parser.parseFromString(htmlContent, 'text/html');
      
      // Select slides (support both .slide and section.slide)
      const slides = doc.querySelectorAll('.slide');

      if (slides.length === 0) {
        throw new Error('ìŠ¬ë¼ì´ë“œ(.slide)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }

      // Loop through each slide
      slides.forEach((slideElem, index) => {
        const slide = pptx.addSlide();
        slide.background = { color: 'FFFFFF' };

        // 1. Check for Special Backgrounds (Gradient, Colors)
        const style = slideElem.getAttribute('style') || '';
        if (style.includes('background') && style.includes('gradient')) {
            // Simple logic for cover/end slides with gradients
            if (style.includes('0071EC') || style.includes('linear-gradient')) {
                slide.background = { color: COLORS.primary }; // Fallback to solid color for safety
            } else if (style.includes('radial-gradient')) {
                slide.background = { color: 'F8FAFC' }; // Light background
            }
        } else if (style.includes('background: var(--hanwha-orange)') || style.includes('#F37321')) {
             slide.background = { color: 'F37321' }; // Hanwha Orange Support
        }

        // 2. Determine Layout Cursor (Y position)
        let yPos = 0.5;

        // 3. Header / Title Parsing
        // Case A: Cover Title (h1 centered)
        const h1 = slideElem.querySelector('h1');
        const actionTitle = slideElem.querySelector('.action-title');

        if (h1 && !actionTitle) {
            // Cover Slide Logic
            const h3 = slideElem.querySelector('h3');
            if (h3) {
                slide.addText(h3.textContent.trim(), { x: 0.5, y: 2.0, w: '90%', fontSize: 18, color: COLORS.muted, align: 'center' });
            }
            
            // Clean up H1 text (remove tags)
            let titleText = h1.innerText.replace(/[\n\r]+/g, ' ').trim();
            slide.addText(titleText, { x: 0.5, y: 2.5, w: '90%', fontSize: 44, color: COLORS.dark, bold: true, align: 'center' });
            
            // Subtitle h2
            const h2 = slideElem.querySelector('h2');
            if (h2) {
                 slide.addText(h2.innerText.trim(), { x: 0.5, y: 4.0, w: '90%', fontSize: 24, color: COLORS.muted, align: 'center' });
            }
            
            yPos = 6.0; // Move cursor way down
        } 
        // Case B: Content Slide Title (.action-title)
        else if (actionTitle) {
            // Blue bottom border line simulation
            slide.addShape(pptx.ShapeType.line, { x: 0.5, y: 1.1, w: 9.0, h: 0, line: { color: COLORS.primary, width: 3 } });
            
            slide.addText(actionTitle.textContent.trim(), {
                x: 0.5, y: 0.4, w: 9.0, h: 0.6,
                fontSize: 24, color: COLORS.dark, bold: true, fontFace: 'Arial'
            });
            yPos = 1.4;
        }

        // 4. Content Parsing (The Complex Part)
        const contentDiv = slideElem.querySelector('.content');
        
        if (contentDiv) {
            // 4-1. Check for Columns (.row)
            const rows = contentDiv.querySelectorAll('.row');
            
            if (rows.length > 0) {
                // Handle Layout Rows
                rows.forEach(row => {
                    const children = row.children; // .col or .box
                    const colCount = children.length;
                    const gap = 0.2;
                    const totalW = 9.0;
                    const colW = (totalW - (gap * (colCount - 1))) / colCount;

                    Array.from(children).forEach((col, cIdx) => {
                        const x = 0.5 + (cIdx * (colW + gap));
                        let colY = yPos;

                        // Render Box Background
                        if (col.classList.contains('box') || col.querySelector('.box')) {
                            slide.addShape(pptx.ShapeType.roundRect, {
                                x: x, y: colY, w: colW, h: 3.5,
                                fill: { color: COLORS.lightBg },
                                line: { color: 'E2E8F0', width: 1 }
                            });
                            colY += 0.2; // Padding
                        }

                        // Render Inner Content
                        parseInnerContent(slide, col, x + 0.15, colY, colW - 0.3);
                    });
                    
                    yPos += 3.8; // Move cursor past the row
                });
            } else {
                // No rows, just vertical content (e.g., Table or Big Stats)
                parseInnerContent(slide, contentDiv, 0.5, yPos, 9.0);
            }
        }

        // 5. Footer (Slide Number)
        const footer = slideElem.querySelector('.footer');
        let slideNumText = (index + 1).toString();
        if (footer) {
             const spans = footer.querySelectorAll('span');
             if (spans.length > 1) slideNumText = spans[1].textContent;
        }
        slide.addText(slideNumText, { x: 9.2, y: 5.2, fontSize: 10, color: 'AAAAAA' });

      });

      // Done
      await pptx.writeFile({ fileName: 'CareerHigh_Hanwha_Strategy.pptx' });
      showStatus('âœ… PPTX ë³€í™˜ ì™„ë£Œ! íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.', 'success');

    } catch (err) {
      console.error(err);
      showStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${err.message}`, 'error');
    }
  }

  // --- Helper: Parse Text/Lists/Tables inside a container ---
  function parseInnerContent(slide, container, x, y, w) {
      let currentY = y;

      // 1. Box Headers (.box-h)
      const headers = container.querySelectorAll('.box-h, h3');
      headers.forEach(h => {
          slide.addText(h.textContent.trim(), {
              x: x, y: currentY, w: w, h: 0.4,
              fontSize: 16, color: COLORS.primary, bold: true
          });
          currentY += 0.45;
      });

      // 2. Big Stats (.big-stat)
      const bigStats = container.querySelectorAll('.big-stat');
      bigStats.forEach(stat => {
           slide.addText(stat.textContent.trim(), {
               x: x, y: currentY, w: w, h: 1.0,
               fontSize: 40, color: COLORS.primary, bold: true, align: 'center'
           });
           currentY += 1.0;
           
           // Labels usually follow stats
           const labels = container.querySelectorAll('.stat-label');
           labels.forEach(l => {
               slide.addText(l.textContent.trim(), {
                   x: x, y: currentY, w: w, fontSize: 14, color: COLORS.muted, align: 'center'
               });
           });
           currentY += 0.5;
      });

      // 3. Lists (ul > li)
      const uls = container.querySelectorAll('ul');
      uls.forEach(ul => {
          const lis = ul.querySelectorAll('li');
          lis.forEach(li => {
               slide.addText('â€¢ ' + li.textContent.trim(), {
                   x: x, y: currentY, w: w,
                   fontSize: 12, color: COLORS.dark,
                   breakLine: true, lineSpacing: 18
               });
               currentY += 0.35; // Estimate height based on text
          });
          currentY += 0.1;
      });

      // 4. Paragraphs (.box-text, p)
      // Exclude .box-h, .big-stat, etc to avoid dupes
      const paragraphs = container.querySelectorAll('p:not(.box-h):not(.stat-label):not(.small)');
      paragraphs.forEach(p => {
          slide.addText(p.textContent.trim(), {
              x: x, y: currentY, w: w,
              fontSize: 12, color: COLORS.muted
          });
          currentY += 0.5;
      });

      // 5. Tables
      const tables = container.querySelectorAll('table');
      tables.forEach(table => {
          const rows = [];
          
          // Headers
          const thead = table.querySelector('thead');
          if (thead) {
              const headerCells = thead.querySelectorAll('th');
              rows.push(Array.from(headerCells).map(th => ({
                  text: th.textContent.trim(),
                  options: { bold: true, color: 'FFFFFF', fill: COLORS.primary, fontSize: 12, align: 'center' }
              })));
          }
          
          // Body
          const tbody = table.querySelector('tbody');
          if (tbody || table.querySelectorAll('tr').length > 0) {
              const trs = tbody ? tbody.querySelectorAll('tr') : table.querySelectorAll('tr');
              trs.forEach(tr => {
                   // Skip header row if already processed
                   if (tr.parentElement.tagName === 'THEAD') return;

                   const cells = tr.querySelectorAll('td');
                   if (cells.length > 0) {
                       const rowData = Array.from(cells).map(td => {
                           let isHighlight = td.classList.contains('hl') || td.classList.contains('bold');
                           return {
                               text: td.textContent.trim(),
                               options: { 
                                   fontSize: 11, 
                                   color: isHighlight ? COLORS.primary : COLORS.dark,
                                   bold: isHighlight,
                                   fill: isHighlight ? 'E0F2FE' : 'FFFFFF'
                               }
                           };
                       });
                       rows.push(rowData);
                   }
              });
          }

          if (rows.length > 0) {
              slide.addTable(rows, { x: x, y: currentY, w: w, rowH: 0.4, border: { color: 'E2E8F0', pt: 1 } });
              currentY += (rows.length * 0.4) + 0.2;
          }
      });
  }

</script>
</body>
</html>
