<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZENITH V7: Universal Pro Engine</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.min.js"></script>

  <style>
    /* Professional Corporate UI */
    :root { 
        --brand: #2c3e50; /* Dark Slate Blue (Professional) */
        --accent: #3498db; /* Corporate Blue */
        --bg: #1e1e1e; 
        --panel: #252526; 
        --text: #d4d4d4; 
    }
    
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }
    .layout { display: grid; grid-template-columns: 300px 1fr; width: 100%; height: 100%; }
    
    /* Sidebar */
    .sidebar { background: var(--panel); border-right: 1px solid #333; padding: 25px; display: flex; flex-direction: column; gap: 20px; z-index: 10; }
    .brand { font-size: 18px; font-weight: 700; color: #fff; letter-spacing: 1px; }
    .brand span { color: var(--accent); }
    
    .status-card { 
        background: #333; border-radius: 6px; padding: 15px; font-size: 12px; color: #aaa; 
        border-left: 3px solid var(--accent);
    }
    
    .btn-build { 
        background: var(--accent); color: white; border: none; padding: 14px; border-radius: 6px; 
        font-weight: 600; cursor: pointer; margin-top: auto; transition: 0.2s;
    }
    .btn-build:hover { background: #2980b9; }
    .btn-build:disabled { background: #555; cursor: not-allowed; }

    /* Editor */
    .editor-area { display: flex; flex-direction: column; background: #1e1e1e; }
    .editor-header { 
        padding: 10px 30px; background: #2d2d2d; border-bottom: 1px solid #333; 
        font-size: 11px; font-weight: bold; color: #888; letter-spacing: 1px;
    }
    textarea { 
        flex: 1; width: 100%; border: none; padding: 40px; 
        background: transparent; color: #e0e0e0; 
        font-family: 'D2Coding', monospace; font-size: 13px; line-height: 1.6; 
        resize: none; outline: none; 
    }
    
    #msgBox { text-align: center; font-size: 12px; margin-bottom: 10px; color: #fff; }
  </style>
</head>
<body>

<div class="layout">
    <div class="sidebar">
        <div class="brand">ZENITH <span>PRO</span></div>
        <div class="status-card">
            <strong>SYSTEM READY</strong><br><br>
            • Layout: Corporate Clean<br>
            • Master: No Branding (Generic)<br>
            • Grid: Auto-Adjustment
        </div>
        <div id="msgBox"></div>
        <button id="genBtn" class="btn-build">EXPORT PPTX</button>
    </div>
    <div class="editor-area">
        <div class="editor-header">HTML SOURCE INPUT</div>
        <textarea id="input" placeholder="여기에 프롬프트 결과(HTML)를 붙여넣으세요."></textarea>
    </div>
</div>

<script>
    const genBtn = document.getElementById('genBtn');
    const input = document.getElementById('input');
    const msgBox = document.getElementById('msgBox');
    
    let pptx;

    // ★ UNIVERSAL DESIGN SPECS (Clean & Professional) ★
    const SPECS = {
        layout: 'LAYOUT_16x9',
        W: 10.0,
        H: 5.625,
        margin: 0.5,
        
        // Colors (Professional Corporate Theme)
        primary: '003366', // Deep Navy
        accent: '0066CC',  // Standard Blue
        textMain: '333333',
        textMuted: '666666',
        lineColor: 'CCCCCC',
        bgBox: 'F7F9FB', // Very light blue-gray
        
        // Typography
        font: "Malgun Gothic",
        
        // Layout Positioning (Official Standard)
        headerY: 0.8, 
        contentY: 1.3,
        footerY: 5.3
    };

    function uiMsg(txt) { msgBox.textContent = txt; }

    function getTextTargets(el) {
        let targets = [];
        if (el.matches && el.matches('p, li, .box-text')) targets.push(el);
        el.querySelectorAll('p, li, .box-text').forEach(c => targets.push(c));
        return targets;
    }

    genBtn.addEventListener('click', async () => {
        const html = input.value.trim();
        if(!html) return uiMsg('Please input HTML code.');

        uiMsg('Generating...');
        genBtn.disabled = true;

        try {
            pptx = new PptxGenJS();
            pptx.layout = SPECS.layout;
            pptx.author = 'Zenith Pro';

            // ★ Define Clean Master Slide (No Logos, Just Structure) ★
            pptx.defineSlideMaster({
                title: 'CLEAN_MASTER',
                background: { color: 'FFFFFF' },
                objects: [
                    // Header Line (Clean Divider)
                    { line: { x: 0.5, y: SPECS.headerY, w: 9.0, h: 0, line: { color: SPECS.primary, width: 2 } } },
                    
                    // Footer: Page Number (Simple & Clean)
                    { text: { text: { type: 'number' }, x: 9.0, y: 5.2, w: 0.5, h: 0.3, align: 'right', color: SPECS.textMuted, fontSize: 10 } }
                ]
            });

            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const slides = doc.querySelectorAll('.slide');

            slides.forEach((slideElem, idx) => {
                const titleNode = slideElem.querySelector('.action-title, h1');
                const titleText = titleNode ? titleNode.textContent.trim() : '';
                const isCover = (idx === 0 && slideElem.querySelector('h1'));

                let slide;
                
                if (isCover) {
                    // Cover Slide (Centered Title)
                    slide = pptx.addSlide();
                    renderCover(slide, titleText, slideElem);
                } else {
                    // Content Slide (Master Template)
                    slide = pptx.addSlide({ masterName: 'CLEAN_MASTER' });
                    // Title Positioned Above Line
                    slide.addText(titleText, { x:0.5, y:0.3, w:9, h:0.5, fontSize:22, color:SPECS.primary, bold:true, fontFace:SPECS.font, valign:'bottom' });
                    
                    // Content Rendering
                    let curY = SPECS.contentY;
                    const contentDiv = slideElem.querySelector('.content') || slideElem;
                    
                    // Filter direct children blocks
                    const blocks = Array.from(contentDiv.children).filter(el => 
                        !el.classList.contains('action-title') && !el.classList.contains('header')
                    );

                    blocks.forEach(block => {
                        let h = 0;
                        if(block.classList.contains('row')) {
                            h = renderRow(slide, block, curY);
                        } else if(block.tagName === 'TABLE') {
                            h = renderTable(slide, block, curY);
                        } else {
                            h = renderBlock(slide, block, curY);
                        }
                        curY += h + 0.3; // Standard Margin
                    });
                }
            });

            await pptx.writeFile({ fileName: 'Zenith_Pro_Deck.pptx' });
            uiMsg('Done!');

        } catch (e) {
            console.error(e);
            uiMsg('Error: ' + e.message);
        } finally {
            genBtn.disabled = false;
        }
    });

    // --- RENDERERS ---

    function renderCover(slide, title, dom) {
        slide.background = { color: 'FFFFFF' };
        // Main Title
        slide.addText(title, { x:0.5, y:2.2, w:9, h:1.5, fontSize:44, color:SPECS.primary, bold:true, align:'center', fontFace:SPECS.font });
        
        // Subtitle
        const sub = dom.querySelector('.subtitle');
        if(sub) {
            slide.addText(sub.textContent.trim(), { x:1.5, y:3.8, w:7, fontSize:18, color:SPECS.textMuted, align:'center', fontFace:SPECS.font });
        }
        
        // Date/Info
        const info = dom.querySelector('.info, div > p');
        if(info) {
             slide.addText(info.textContent.trim(), { x:0.5, y:5.0, w:9, fontSize:12, color:SPECS.textMuted, align:'center' });
        }
    }

    function renderRow(slide, rowDom, y) {
        const cols = Array.from(rowDom.children);
        const gap = 0.2;
        const colW = (9.0 - (gap * (cols.length - 1))) / cols.length;
        let maxH = 0;

        cols.forEach((col, i) => {
            const x = 0.5 + (i * (colW + gap));
            const h = estimateHeight(col, colW);
            if(h > maxH) maxH = h;
            
            // Box Background
            if(col.classList.contains('box')) {
                slide.addShape(pptx.ShapeType.rect, {
                    x:x, y:y, w:colW, h:h,
                    fill:{color:SPECS.bgBox}, line:{color:SPECS.lineColor, width:1}
                });
            }
            
            renderContentInBox(slide, col, x + 0.2, y + 0.2, colW - 0.4);
        });
        return Math.max(maxH, 2.0);
    }

    function renderTable(slide, table, y) {
        const rows = [];
        table.querySelectorAll('tr').forEach((tr, rIdx) => {
            const rowData = [];
            tr.querySelectorAll('td, th').forEach(cell => {
                const isHead = cell.tagName === 'TH' || tr.parentElement.tagName === 'THEAD';
                rowData.push({
                    text: cell.textContent.trim(),
                    options: {
                        fill: isHead ? SPECS.primary : (rIdx%2===0 ? 'FFFFFF' : 'F9F9F9'),
                        color: isHead ? 'FFFFFF' : SPECS.textMain,
                        bold: isHead, fontSize:11, fontFace:SPECS.font,
                        border:{color:SPECS.lineColor, pt:1}, align: isHead ? 'center' : 'left'
                    }
                });
            });
            rows.push(rowData);
        });
        
        const tableH = rows.length * 0.4;
        slide.addTable(rows, { x:0.5, y:y, w:9.0, rowH:0.4 });
        return tableH;
    }

    function renderBlock(slide, block, y) {
        const h = estimateHeight(block, 9.0);
        renderContentInBox(slide, block, 0.5, y, 9.0);
        return h;
    }

    function renderContentInBox(slide, el, x, y, w) {
        let curY = y;
        
        // Box Title
        const title = el.querySelector('.box-title');
        if(title) {
            slide.addText(title.textContent.trim(), { 
                x:x, y:curY, w:w, h:0.4, fontSize:13, color:SPECS.accent, bold:true 
            });
            curY += 0.5;
        }

        const nodes = getTextTargets(el);
        nodes.forEach(node => {
            if(node.classList.contains('box-title')) return;
            
            const txt = node.textContent.trim();
            const isList = node.tagName === 'LI';
            
            // Generic Semantic Colors
            let color = SPECS.textMain;
            if(node.classList.contains('text-red')) color = 'D00000';
            if(node.classList.contains('text-green')) color = '008800';
            if(node.classList.contains('text-blue') || node.classList.contains('orange-text')) color = SPECS.accent;

            slide.addText(txt, {
                x:x, y:curY, w:w, h:0.4, 
                fontSize:12, color:color, 
                bullet: isList ? { indent:10 } : false,
                breakLine:true, fontFace:SPECS.font
            });
            curY += 0.35;
        });
    }

    function estimateHeight(el, w) {
        const targets = getTextTargets(el);
        const lineCount = targets.length;
        const hasTitle = el.querySelector('.box-title') ? 1 : 0;
        return (lineCount * 0.35) + (hasTitle * 0.5) + 0.5; 
    }
</script>
</body>
</html>
