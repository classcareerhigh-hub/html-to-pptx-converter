<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>HTML to PPTX Converter (Fixed Layout)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, sans-serif;
      background: linear-gradient(135deg, #EBF4FF 0%, #E0E7FF 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .header {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 40px;
      margin-bottom: 24px;
    }
    h1 { font-size: 32px; font-weight: 700; color: #111; }
    .subtitle { color: #666; font-size: 16px; margin-top: 4px; }
    .main-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 40px;
      margin-bottom: 24px;
    }
    textarea {
      width: 100%;
      height: 400px;
      padding: 16px;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
    }
    .button-group { display: flex; gap: 12px; margin-top: 16px; }
    button {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0071EC 0%, #5050EF 100%);
      color: white;
      flex: 1;
    }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-primary:disabled { background: #D1D5DB; cursor: not-allowed; }
    .status {
      margin-top: 16px;
      padding: 16px;
      border-radius: 8px;
      display: none;
    }
    .status.show { display: block; }
    .status.success { background: #D1FAE5; color: #065F46; }
    .status.error { background: #FEE2E2; color: #991B1B; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä HTML to PPTX Converter (Fixed)</h1>
      <p class="subtitle">Ìè∞Ìä∏ ÌÅ¨Í∏∞ ÏµúÏ†ÅÌôî Î≤ÑÏ†Ñ</p>
    </div>

    <div class="main-content">
      <h2 style="margin-bottom: 16px;">HTML ÏΩîÎìú ÏûÖÎ†•</h2>
      <textarea id="htmlInput" placeholder="HTML ÏΩîÎìúÎ•º Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî..."></textarea>
      <div class="button-group">
        <button class="btn-primary" id="convertBtn">PPTXÎ°ú Î≥ÄÌôòÌïòÍ∏∞</button>
      </div>
      <div id="statusMessage" class="status"></div>
    </div>
  </div>

  <script src="https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <script>
    const htmlInput = document.getElementById('htmlInput');
    const convertBtn = document.getElementById('convertBtn');
    const statusMessage = document.getElementById('statusMessage');

    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status show ${type}`;
    }

    convertBtn.addEventListener('click', async () => {
      const html = htmlInput.value.trim();
      if (!html) {
        showStatus('HTML ÏΩîÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
        return;
      }

      convertBtn.disabled = true;
      convertBtn.textContent = 'Î≥ÄÌôò Ï§ë...';
      showStatus('PPTX ÏÉùÏÑ± Ï§ë...', 'info');

      try {
        let pptx;
        if (typeof window.PptxGenJS !== 'undefined') {
          pptx = new window.PptxGenJS();
        } else if (typeof window.pptxgen !== 'undefined') {
          pptx = new window.pptxgen();
        } else {
          throw new Error('ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ïã§Ìå®');
        }

        pptx.layout = 'LAYOUT_16x9';
        pptx.author = 'Career High';
        pptx.title = 'Presentation';

        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const slides = doc.querySelectorAll('.slide');

        if (slides.length === 0) {
          throw new Error('class="slide"Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }

        slides.forEach((slideElement) => {
          const slide = pptx.addSlide();
          slide.background = { color: 'FFFFFF' };

          let yPosition = 1.0;

          // H2 (ÏÜåÏ†úÎ™©)
          const h2 = slideElement.querySelector('h2');
          if (h2) {
            slide.addText(h2.textContent.trim(), {
              x: 0.6,
              y: yPosition,
              fontSize: 12,
              color: '0071EC',
              bold: true,
              fontFace: 'Arial'
            });
            yPosition += 0.35;
          }

          // H1 (Ï†úÎ™©) - ÌÅ¨Í∏∞ Ï§ÑÏûÑ!
          const h1 = slideElement.querySelector('h1');
          if (h1) {
            const h1Text = h1.innerHTML.replace(/<br\s*\/?>/gi, '\n');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = h1Text;

            slide.addText(tempDiv.textContent.trim(), {
              x: 0.6,
              y: yPosition,
              w: 8.5,
              fontSize: 32,  // 42 ‚Üí 32Î°ú Ï∂ïÏÜå
              color: '111111',
              bold: true,
              fontFace: 'Arial',
              lineSpacing: 40
            });
            yPosition += 1.0;
          }

          // P (Î≥∏Î¨∏) - ÌÅ¨Í∏∞ Ï§ÑÏûÑ!
          const paragraphs = slideElement.querySelectorAll('p');
          paragraphs.forEach(p => {
            const pText = p.innerHTML.replace(/<br\s*\/?>/gi, '\n');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = pText;

            slide.addText(tempDiv.textContent.trim(), {
              x: 0.6,
              y: yPosition,
              w: 8.5,
              fontSize: 14,  // 18 ‚Üí 14Î°ú Ï∂ïÏÜå
              color: '666666',
              fontFace: 'Arial',
              lineSpacing: 20
            });
            yPosition += 0.6;
          });

          // UL (Î¶¨Ïä§Ìä∏) - ÌÅ¨Í∏∞ Ï§ÑÏûÑ!
          const ul = slideElement.querySelector('ul');
          if (ul) {
            const items = ul.querySelectorAll('li');
            items.forEach(li => {
              slide.addText('‚Ä¢ ' + li.textContent.trim(), {
                x: 0.8,
                y: yPosition,
                w: 8.3,
                fontSize: 14,  // 18 ‚Üí 14Î°ú Ï∂ïÏÜå
                color: '666666',
                fontFace: 'Arial'
              });
              yPosition += 0.35;
            });
          }

          // key-box
          const keyBox = slideElement.querySelector('.key-box');
          if (keyBox) {
            slide.addShape(pptx.ShapeType.rect, {
              x: 0.6,
              y: yPosition,
              w: 8.5,
              h: 0.6,
              fill: { color: 'E8F4FF' },
              line: { color: '0071EC', pt: 3 }
            });

            slide.addText(keyBox.textContent.trim(), {
              x: 0.8,
              y: yPosition + 0.12,
              w: 8.1,
              fontSize: 14,
              color: '111111',
              fontFace: 'Arial',
              bold: true
            });
            yPosition += 0.8;
          }

          // Table - ÌÅ¨Í∏∞ Ï§ÑÏûÑ!
          const table = slideElement.querySelector('table');
          if (table) {
            const rows = [];
            
            const thead = table.querySelector('thead');
            if (thead) {
              const headerCells = thead.querySelectorAll('th');
              rows.push(Array.from(headerCells).map(th => ({
                text: th.textContent.trim(),
                options: { bold: true, color: 'FFFFFF', fill: '0071EC', fontSize: 12 }
              })));
            }

            const tbody = table.querySelector('tbody');
            if (tbody) {
              tbody.querySelectorAll('tr').forEach(tr => {
                rows.push(Array.from(tr.querySelectorAll('td')).map(td => ({
                  text: td.textContent.trim(),
                  options: { fontSize: 11, color: '111111' }
                })));
              });
            }

            slide.addTable(rows, {
              x: 0.6,
              y: yPosition,
              w: 8.5,
              border: { pt: 1, color: 'E5E7EB' },
              rowH: 0.35
            });
          }

          // Slide number
          const pageNum = slideElement.getAttribute('data-page');
          if (pageNum) {
            slide.addText(pageNum, {
              x: 9.0,
              y: 5.0,
              fontSize: 10,
              color: 'DDDDDD',
              bold: true,
              fontFace: 'Arial'
            });
          }
        });

        await pptx.writeFile({ fileName: 'Presentation_Fixed.pptx' });
        showStatus(`‚úÖ ÏôÑÎ£å! ${slides.length}Í∞ú Ïä¨ÎùºÏù¥Îìú ÏÉùÏÑ±`, 'success');

      } catch (error) {
        console.error(error);
        showStatus('‚ùå Ïò§Î•ò: ' + error.message, 'error');
      } finally {
        convertBtn.disabled = false;
        convertBtn.textContent = 'PPTXÎ°ú Î≥ÄÌôòÌïòÍ∏∞';
      }
    });
  </script>
</body>
</html>
